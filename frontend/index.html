<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>OAuth 2.0 Demo</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <h1>OAuth 2.0 Demo</h1>
  <button id="loginButton">Login with Auth0</button>

  <script type="module">
    import { DOMAIN, CLIENT_ID, API_AUDIENCE, REDIRECT_URI } from './js/config.js';
    import { generateRandomString, pkceChallengeFromVerifier } from './js/pkce.js';

    document.getElementById('loginButton').onclick = async () => {
      // Generate a PKCE verifier and challenge
      const verifier = generateRandomString(64);
      localStorage.setItem('code_verifier', verifier);

      const challenge = await pkceChallengeFromVerifier(verifier);

      const authUrl = `https://${DOMAIN}/authorize?` +
        new URLSearchParams({
          response_type: 'code',
          client_id: CLIENT_ID,
          redirect_uri: REDIRECT_URI,
          scope: 'openid profile email',
          audience: API_AUDIENCE,
          code_challenge: challenge,
          code_challenge_method: 'S256'
        });

      window.location = authUrl;
    };
  </script>

</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>OAuth 2.0 Demo</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <h1>OAuth 2.0 Demo</h1>
  <button id="login-button">Login with Auth0</button>

  <script type="module">
    import { AUTH0_DOMAIN, CLIENT_ID, API_AUDIENCE } from './js/config.js';
    import { pkceChallengeFromVerifier } from './js/pkce.js';
    document.getElementById('loginButton').onclick = async () => {
      const verifier = pkceChallengeFromVerifier();
      localStorage.setItem('pkce_code_verifier', verifier);

      const challenge = await pkceChallengeFromVerifier(verifier);

      const authUrl = `https://${AUTH0_DOMAIN}/authorize?` +
        new URLSearchParams({
          response_type: 'code',
          client_id: CLIENT_ID,       // <--- now defined
          redirect_uri: window.location.origin + '/callback.html',
          scope: 'openid profile email',
          audience: API_AUDIENCE,
          code_challenge: challenge,
          code_challenge_method: 'S256'
        });

      window.location = authUrl;
    };
  </script>

</body>

</html>